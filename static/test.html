<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<title>响应式导航</title>

	<!--默认样式-->
	<link rel="stylesheet" href="static/css/reset.css" />

	<!--响应式框架-->
	<link rel="stylesheet" type="static/text/css" href="static/css/bootstrap.css">

	<!--主要样式-->
	<link rel="stylesheet" href="static/css/head.css" />

</head>
<body style="background-color: #e6e6e6;">
	<!-- 导航 -->
	<header class="header">
		<div class="container clearfix">
<!--			<div class="fl left">-->
<!--				<a href="javascript:void(0)" ><img src="image/logo_mini.ico" alt="" class="img1" /></a>-->
<!--				<a href="javascript:void(0)" ><img src="image/logo2.jpg" alt="" class="img2" /></a>-->
<!--			</div>-->
			<div class="fr nav">
<!--					<div class="box" style="">-->
<!--						<h3 style="text-align: center; color: #b3bcb2">Take It Easy</h3>-->
<!--					</div>-->
				<ul class="navbar_nav" data-in="fadeInDown" data-out="fadeOutUp">
<!--					<li class="navbar_nav_t" data-in="fadeInDown" data-out="fadeOutUp" style="color: #ffffff">-->
						<h3 class="navbar_nav_t" style="color: #ffffff;">Take It Easy</h3>
<!--					</li>-->
					<li class="dropdown">
						<a href="javascript:void(0)">投稿</a>
					</li>
					<li>
						<a href="javascript:void(0)">用户须知</a>
					</li>
					<li>
						<a href="javascript:void(0)">关于我们</a>
					</li>
				</ul>
			</div>
			<a href="javascript:void(0)" id="navToggle">
	            <span></span>
	        </a>
		</div>
	</header>
	<!--移动端的导航-->
	<div class="m_nav">
		<div class="top clearfix">
{#			<img src="image/closed.png" alt="" class="closed" />#}
		</div>
		<div class="logo">
{#			<img src="image/logo2.jpg" alt="" />#}
		</div>

	</div>
	// 这里就是聊天室 B是自己  A是服务器消息
<div class="talk_con">
        <input type="text" class="talk_top" id="name">
		<input type="button" value="连接" class="talk_top" id="connbtn">
        <div class="talk_show" id="words">
<!--            <div class="atalk"><span id="asay">A说：吃饭了吗？</span></div>-->
<!--            <div class="btalk"><span id="bsay">B说：还没呢，你呢？</span></div>-->
        </div>
        <div class="talk_input">
<!--            <select class="whotalk" id="who">-->
<!--                <option value="0">A说：</option>-->
<!--                <option value="1">B说：</option>-->
<!--            </select>-->
            <input type="text" class="talk_word" id="talkwords">
            <input type="button" value="发送" class="talk_sub" id="talksub">
        </div>
    </div>
	<script src="static/js/jquery.min.js"></script>
<script type="text/javascript">
    //
        window.onload = function(){
            var Words = document.getElementById("words");
            // var Who = document.getElementById("who");
            var TalkWords = document.getElementById("talkwords");
            var TalkSub = document.getElementById("talksub");

            {#var Send = document.getElementById("talksub");#}
            var ConnBtn = document.getElementById("connbtn");


			//连接
			ConnBtn.onclick = function(){
                var name = document.getElementById('name');
			    if (name.value === ''){
			        str = '<div class="atalk"><span>请输入用户名</span></div>';
                    Words.innerHTML = Words.innerHTML + str;
                }
			    else
				var wsurl = 'ws://127.0.0.1/chat/chat?roomNum=1&name=' + name.value;


				websocket = new WebSocket(wsurl);

            //连接建立
            websocket.onopen = function (event) {
                console.log("Connected to WebSocket server.");
                var str = '';
                str = '<div class="atalk"><span>连接成功</span></div>';
                Words.innerHTML = Words.innerHTML + str;
            };
            //收到消息
            websocket.onmessage = function (event) {
                var msg = JSON.parse(event.data); //解析收到的json消息数据

				var str = "";
                var type = msg.type; // 消息类型
                var umsg = msg.message; //消息文本
                var uname = msg.name; //发送人

                if (type == 'system') {
					str = '<div class="atalk"><span>系统消息 :' + TalkWords.value +'</span></div>';
                }
                if (type == 'usermsg') {
                    if (uname == name.value){
                        str = '<div class="btalk"><span>' + name.value + '：' + TalkWords.value +'</span></div>';
                    }else{
                        str = '<div class="atalk"><span>' + uname + '：' + TalkWords.value +'</span></div>';
                    }
                }

                Words.innerHTML = Words.innerHTML + str;

            };
            //发生错误
            websocket.onerror = function (event) {
                var str = "";
                console.log("Connected to WebSocket server error");
                str = '<div class="atalk"><span>连接失败</span></div>';
                Words.innerHTML = Words.innerHTML + str;
            };

            //连接关闭
            websocket.onclose = function (event) {
                var str = "";
                console.log('websocket Connection Closed. ');
                str = '<div class="atalk"><span>连接关闭</span></div>';
                Words.innerHTML = Words.innerHTML + str;
            };
			};

            // 聊天
            TalkSub.onclick = function(){
	            //定义空字符串
                if(TalkWords.value == ""){
	                 // 消息为空时弹窗
                    alert("消息不能为空");
                    return;
                }
                send();

                //if(Who.value == 0){
	                //如果Who.value为0n那么是 A说
                //    str = '<div class="atalk"><span>A说 :' + TalkWords.value +'</span></div>';
                //}
                //else{
                //    str = '<div class="btalk"><span>B说 :' + TalkWords.value +'</span></div>' ;
                //}
                //Words.innerHTML = Words.innerHTML + str;
            };
                    function send() {
                var message = document.getElementById("talkwords");

                if (!message) {
                    alert('发送消息不能为空!');
                    return false;
                }

                try {
                    console.log(message.value);
                    if(typeof websocket=="undefined"){
                        alert('请输入用户名后连接');
                        return ;
                    }
                    websocket.send(JSON.stringify({'message':message.value}));
                } catch (ex) {
                    console.log(ex);
                }
            }
        }


    </script>
	<script>
		$(function(){
			//超过一定高度导航添加类名
			var nav=$("header"); //得到导航对象
			var win=$(window); //得到窗口对象
			var sc=$(document);//得到document文档对象。
			win.scroll(function(){
			  if(sc.scrollTop()>=100){
			    nav.addClass("on");
			  }else{
			   nav.removeClass("on");
			  }
			})

			//移动端展开nav
			$('#navToggle').on('click',function(){
				$('.m_nav').addClass('open');
			})
			//关闭nav
			$('.m_nav .top .closed').on('click',function(){
				$('.m_nav').removeClass('open');
			})

			//二级导航  移动端
		    $(".m_nav .ul li").click(function() {
				$(this).children("div.dropdown_menu").slideToggle('slow')
		        $(this).siblings('li').children('.dropdown_menu').slideUp('slow');
		    });

		})
	</script>

</body>
</html>