<!DOCTYPE html>
<html lang="zh" style="height: 100%; width: 100%;">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title></title>
	
	<link rel="stylesheet" href="../static/layui/css/layui.css">
	<link rel="stylesheet" href="../static/css/base.css">
	<script src="../static/layui/layui.js"></script>
</head>
<body style="height: 100%; width: 100%">
		<!-- 导航栏 -->
	<ul class="layui-nav">
		<li class="layui-nav-item" style="font-size: x-large; font-family: mFont; left: 45%;">Take It Easy</li>
		<!-- 下面应该是弹窗 -->
		<!-- TODO 这个可以用弹出层，如果没bug的话 -->
		<li class="layui-nav-item" style="float: right;"><a id="aboutUs">关于我们</a></li>
		<li class="layui-nav-item" style="float: right;"><a id="userNotice">用户须知</a></li>
		<li class="layui-nav-item" style="float: right;"><a id="finalNotice">最新公告</a></li>
	</ul>
	
	<!-- 资讯版 -->
	<div style="height: calc(100% - 60px);">
		<!-- 资讯导航 -->
		<div style="margin: auto; width: 300px; font-size:30px" class="layui-breadcrumb" lay-separator=" |">
			<a id="typeAll">首页</a>
			<a id="typeIdo">娱乐</a>
			<a id="typeGame">电竞</a>
			<a id="typePhone">数码</a>
			<a id="typeElse">杂谈</a>
		</div>
		<!-- 资讯 -->
		<div style="height:calc(100% - 95px)">
			<div style="margin: auto; height: 100%; width: 60%; min-width: 80%; padding-top: 20px;">
				<div style="width: 50%; height: 100%; margin: auto;">
					<div id="news1" style="height: 16.6%; padding: 0px;">
						<!-- 图片 -->
						<div style="float: left;">
							<img id="img1" style="width: 160px; height: 110px; display:inline-block;" src="">
						</div>
						<!-- 文字 -->
						<div style="padding-left: 170px;">
							<!-- 标题 -->
							<a id="tittle1" target="_blank" style="display: block; font-size: 20px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;"></a>
							<!-- 摘要 -->
							<div id="abst1" style="overflow:hidden; -webkit-box-orient: vertical; display:-webkit-box; text-overflow:ellipsis; -webkit-line-clamp:4;"></div>
							<!-- 时间 来源 -->
							<div id="time1"></div>
						</div>
					</div>
					<div id="news2" style="height: 16.6%; padding: 0px;">
						<div style="float: left;">
							<img id="img2" style="width: 160px; height: 110px; display:inline-block;" src="">
						</div>
						<div style="padding-left: 170px;">
							<a id="tittle2" style="display: block; font-size: 20px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;"></a>
							<div id="abst2" style="overflow:hidden; -webkit-box-orient: vertical; display:-webkit-box; text-overflow:ellipsis; -webkit-line-clamp:4;"></div>
							<div id="time2"></div>
						</div>
					</div>
					<div id="news3" style="height: 16.6%; padding: 0px;">
						<div style="float: left;">
							<img id="img3" style="width: 160px; height: 110px; display:inline-block;" src="">
						</div>
						<div style="padding-left: 170px;">
							<a id="tittle3" style="display: block; font-size: 20px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;"></a>
							<div id="abst3" style="overflow:hidden; -webkit-box-orient: vertical; display:-webkit-box; text-overflow:ellipsis; -webkit-line-clamp:4;"></div>
							<div id="time3"></div>
						</div>
					</div>
<!-- 				</div>
				<div style="width: 50%; height: 100%; float: right;"> -->
					<div id="news4" style="height: 16.6%; padding: 0px;">
						<div style="float: left;">
							<img id="img4" style="width: 160px; height: 110px; display:inline-block;" src="">
						</div>
						<div style="padding-left: 170px;">
							<a id="tittle4" style="display: block; font-size: 20px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;"></a>
							<div id="abst4" style="overflow:hidden; -webkit-box-orient: vertical; display:-webkit-box; text-overflow:ellipsis; -webkit-line-clamp:4;"></div>
							<div id="time4"></div>
						</div>
					</div>
					<div id="news5" style="height: 16.6%; padding: 0px;">
						<div style="float: left;">
							<img id="img5" style="width: 160px; height: 110px; display:inline-block;" src="">
						</div>
						<div style="padding-left: 170px;">
							<a id="tittle5" style="display: block; font-size: 20px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;"></a>
							<div id="abst5" style="overflow:hidden; -webkit-box-orient: vertical; display:-webkit-box; text-overflow:ellipsis; -webkit-line-clamp:4;"></div>
							<div id="time5"></div>
						</div>
					</div>
					<div id="news6" style="height: 16.6%; padding: 0px;">
						<div style="float: left;">
							<img id="img6" style="width: 160px; height: 110px; display:inline-block;" src="">
						</div>
						<div style="padding-left: 170px;">
							<a id="tittle6" style="display: block; font-size: 20px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;"></a>
							<div id="abst6" style="overflow:hidden; -webkit-box-orient: vertical; display:-webkit-box; text-overflow:ellipsis; -webkit-line-clamp:4;"></div>
							<div id="time6"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 分页栏 -->
		<div id="newsPlate" style="text-align: center;"></div>
	</div>



</body>
<script>
	autoWidthRate = 0.4;
	autoHeightRate = 0.8;
	boxWidth = 180;
	boxHeight = 40;
	chooseType = "all";
	
	// 清空cute
	var clear_cute = function(){
		$("#typeAll").html("首页");
		$("#typeIdo").html("娱乐");
		$("#typePhone").html("数码");
		$("#typeGame").html("电竞");
		$("#typeElse").html("杂谈");
	};
	// 重置当前页面
	var clear_news = function(){
		for(var i=0;i<6;i++){
			$("#img" + (i + 1)).attr("src", "");
			$("#tittle" + (i + 1)).html("");
			$("#abst" + (i + 1)).html("");
			$("#time" + (i + 1)).html("");
		};
	};
	// 获取总页数的ajax
	var get_page_num = function(type){
		$.ajax({
			url: "/news/page_num",
			type: "POST",
			dataType: "json",
			data: JSON.stringify({
				'type': type,
				'limit': 6, // 每页最大展现
			}),
			success: function(data){
				//执行一个laypage实例
				laypage.render({
					elem: 'newsPlate', //注意，这里的 test1 是 ID，不用加 # 号
					count: data.pageNum, //数据总数，从服务端得到
					limit: 6, // 每页展现个数
					jump: function(obj, first){
						//obj包含了当前分页的所有参数，比如：
						// console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
						// console.log(obj.limit); //得到每页显示的条数
						//首次不执行
						if(!first){
							get_page(chooseType, obj.curr);
						};
					},
				});
			}
		});
	};

	// 获取资讯的ajax
	var get_page = function(type, pageNum){
		clear_news();
		$.ajax({
			url: "/news/page",
			type: "POST",
			dataType: "json",
			data: JSON.stringify({
				'type': type,
				'limit': 6, // 每页最大展现
				'pageNum': pageNum // 页数
			}),
			success: function(data){
				var data = data.data;
				for(var i=0;i<6; i++){
					if(data.length%6 != 0 && i >= data.length%6){
						$("#img" + (i + 1)).hide();
						continue;
					}else{
						$("#img" + (i + 1)).show();
					};
					var type = data[i][0];
					var tittle = data[i][1];
					var time = data[i][2];
					var abst = data[i][3];
					var url = data[i][4];
					var purl1 = data[i][5][0];
					// var purl2 = data[i][6][0];
					// var purl3 = data[i][7][0];
					// console.log(url);

					$("#img" + (i + 1)).attr("src", purl1);
					$("#tittle" + (i + 1)).html(tittle);
					$("#tittle" + (i + 1)).attr("href", url);
					$("#abst" + (i + 1)).html(abst);
					time = new Date(parseInt(1593328500) * 1000).toLocaleString().replace(/:\d{1,2}$/,' ');
					$("#time" + (i + 1)).html(time);
				};
				clear_cute();
				if(type == "all"){
					$("#typeAll").html("<cite>首页</cite>");
				}else if(type == "ido"){
					$("#typeIdo").html("<cite>娱乐</cite>");
				}else if(type == "phone"){
					$("#typePhone").html("<cite>数码</cite>");
				}else if(type == "game"){
					$("#typeGame").html("<cite>电竞</cite>");
				}else if(type == 'else'){
					$("#typeElse").html("<cite>杂谈</cite>");
				};
			if(chooseType != type){
				chooseType = type;
				get_page_num(chooseType);
			}else{
				chooseType = type;
			};
			},
		});
	};
	// px转换小数字
	function toNum(percent){
			var num=Number(percent.replace("px", ''));;
			return num;
		};
	function min($){
		// 这个只能 上和左才生效
		var seeWidth = document.body.scrollWidth;
		var seeHeight = document.body.clientHeight;
		
		$(".layui-layer").css({"min-width": boxWidth});
		$(".layui-layer").css({"left": seeWidth - boxWidth});
		$(".layui-layer").css({"top": seeHeight - boxHeight});
		
		$(".layui-layer-shade").hide();
		
		iframeSize = "min";
	};
	function restore($){
		// 隐藏最大化按钮
		$(".layui-layer").css({"min-width": 400});
		var width = document.querySelector(".layui-layer").style.width;
		var height = document.querySelector(".layui-layer").style.height;
		var seeWidth = document.body.scrollWidth;
		var seeHeight = document.body.scrollHeight;
		
		$(".layui-layer").css({"left": (seeWidth - toNum(width)) * 0.5});
		$(".layui-layer").css({"top": (seeHeight - toNum(height)) * 0.5});
		
		$(".layui-layer-shade").show();
		
		iframeSize = "max";
	};
	function resize(){
		var seeWidth = document.body.scrollWidth;
		var seeHeight = document.body.scrollHeight;
		if(iframeSize == "max"){
			// 弹窗大小
			var width = seeWidth * autoWidthRate;
			var height = seeHeight * autoHeightRate;
			$(".layui-layer").css("width", width);
			$(".layui-layer").css("height", height);
			// 悬浮位置
			if (width <= 400){width = 400};
			$(".layui-layer").css({"left": (seeWidth - width) * 0.5});
			$(".layui-layer").css({"top": (seeHeight - height) * 0.5});
			// 页面大小改变后iframe页面也要调整高度
			// var tittleHeight = toNum($(".layui-layer-title").css("height"));
			// $(".layui-layer").css("height", height - tittleHeight);
			// 跨域设置子页面高度
			// $("#layui-layer-iframe100001").contents().find("#sendBtn").hide();
		}else if(iframeSize == "min"){
			$(".layui-layer").css({"position": ""});
			$(".layui-layer").css({"min-width": boxWidth});
			$(".layui-layer").css({"left": seeWidth - boxWidth});
			$(".layui-layer").css({"top": seeHeight - boxHeight});
		};
	};
	//注意：导航 依赖 element 模块，否则无法进行功能性操作
	layui.use("element", function(){
		var element = layui.element;
		element.init();
	});
	layui.use(["jquery"], function(){
		$ = jQuery = layui.$;
		// 改变窗口大小
		window.onresize = function(){
			resize();
		};

		window.onload = function(){
			// 首次加载的ajax
			get_page('all', 1);
			// 按钮绑定
			$("#typeAll").click(function(){
				get_page('all', 1);
			});
			$("#typeIdo").click(function(){
				get_page('ido', 1);
			});
			$("#typeGame").click(function(){
				get_page('game', 1);
			});
			$("#typePhone").click(function(){
				get_page('phone', 1);
			});
			$("#typeElse").click(function(){
				get_page('else', 1);
			}); 
		};
		

		
		$("#aboutUs").click(function(){
			var c = "这是关于我们";
			layer.open({
				type: 1
				,title: false //不显示标题栏
				,closeBtn: false
				,area: ["40%", "80%"]
				,shade: 0.8
				,id: 'layerUserNotice' //设定一个id，防止重复弹出
				,btn: ['我知道了']
				,btnAlign: 'c'
				,moveType: 1 //拖拽模式，0或者1
				,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">' + c + '</div>'
				,success: function(layero){
				}
			});
		});
		$("#userNotice").click(function(){
			var c = "这是用户须知";
			layer.open({
				type: 1
				,title: false //不显示标题栏
				,closeBtn: false
				,area: ["40%", "80%"]
				,shade: 0.8
				,id: 'layerUserNotice' //设定一个id，防止重复弹出
				,btn: ['我知道了']
				,btnAlign: 'c'
				,moveType: 1 //拖拽模式，0或者1
				,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">' + c + '</div>'
				,success: function(layero){
				}
			});
		});
		$("#finalNotice").click(function(){
			var c = "最新公告";
			layer.open({
				type: 1
				,title: false //不显示标题栏
				,closeBtn: false
				,area: ["40%", "80%"]
				,shade: 0.8
				,id: 'layerUserNotice' //设定一个id，防止重复弹出
				,btn: ['我知道了']
				,btnAlign: 'c'
				,moveType: 1 //拖拽模式，0或者1
				,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">' + c + '</div>'
				,success: function(layero){
				}
			});
		});
	});
	layui.use('layer', function(){
		layer = layui.layer;
		var openChatroom = layer.open({
			title: ["T I E", "font-size:18px;"],
			anim: 5,							// 动画 渐显
			skin: "layui-layer-molv",			// 弹窗主题风格
			type: 2,							// 声明弹出方式为iframe
			content: ["chatroom.html", "no"],	// 弹出的html文件
			area: ["40%", "80%"],				// 弹出的宽高
			closeBtn: 0,						// 没有关闭按钮
			maxmin: true,						// 支持最大最小化
			shade: [0.1, '#555555'],			// 遮罩颜色
			shadeClose: true,
			success: function(layero){
				layero.find(".layui-layer-max").hide();
				$(".layui-layer").css("overflow", "hidden");
				$(".layui-layer").css({"min-width": 400});
				layero.customId = 'idddd';
				
			},
			full: function(layero) {
					layer.restore(openChatroom);
				},
			min: function(layero){
				layero.find(".layui-layer-max").show();
				min($);
			},
			restore: function(layero){
				layero.find(".layui-layer-max").hide();
				restore($);
				resize($);
			},
		});
		iframeSize = "max";
		resize();
		//重新渲染
		var reRendering = function(){
			// 全局导航 .layui-nav
			// 聊天室标题 .layui-layer-title
			$(".layui-nav").css("background-color","#f2debd");
			$(".layui-layer-title").css("background-color","#f2debd");
		};
		reRendering();
		layui.use('laypage', function(){
			laypage = layui.laypage;
		
			$.ajax({
				url: "/news/page_num",
				type: "POST",
				dataType: "json",
				data: JSON.stringify({
					'type': chooseType,
					'limit': 6 // 每页最大展现
				}),
				success: function(data){
					//执行一个laypage实例
					laypage.render({
						elem: 'newsPlate', //注意，这里的 test1 是 ID，不用加 # 号
						count: data.pageNum, //数据总数，从服务端得到
						limit: 6, // 每页展现个数
						jump: function(obj, first){
							//obj包含了当前分页的所有参数，比如：
							// console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
							// console.log(obj.limit); //得到每页显示的条数
							//首次不执行
							if(!first){
								get_page(chooseType, obj.curr);
							}
						},
					});
				}
			});
		});
	});
</script>
</html>
<!-- 断连有问题，断连逻辑应该重写，如果本地主动断连，就不弹窗 -->